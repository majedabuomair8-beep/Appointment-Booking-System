<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ù…Ù†ØµØªÙƒ Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ â€” Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ | Your General Appointment Platform Appointments</title>
  <meta name="description" content="Ù…Ù†ØµØ© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¹Ø§Ù…Ø© Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù„Ø£ÙŠ Ø¬Ù‡Ø© Ø£Ùˆ Ø®Ø¯Ù…Ø© Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ³Ø±Ø¹Ø©. Ù…Ù†ØµØ© Ø±Ø³Ù…ÙŠØ© Ù„Ø­Ø¬Ø² Ù…ÙˆØ§Ø¹ÙŠØ¯  ÙÙŠ Ø§Ù„Ø£Ø±Ø¯Ù† â€” Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹ Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø±.">
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;800&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
  <!-- Map & QR -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <style>
    :root{
      --general:#007B83; --bg:#F5F5F5; --card:#ffffff; --text:#1f2937; --muted:#6b7280; --border:#e5e7eb; --accent:#fef3c7;
    }
    :root.dark{ --bg:#0b0f14; --card:#0f141b; --text:#e5e7eb; --muted:#94a3b8; --border:#1f2937; --accent:#1f2937; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:"Cairo","Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial}
    a{color:var(--general);text-decoration:none}
    .container{max-width:1120px;margin:auto;padding:0 16px}
    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.75);backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid var(--border)}
    :root.dark header{background:rgba(15,20,27,.7)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{width:40px;height:40px;border-radius:8px;object-fit:contain;background:#fff;border:1px solid var(--border)}
    .logo-fallback{width:40px;height:40px;border-radius:10px;background:var(--general);display:none;place-items:center;color:#fff;font-weight:800}
    .title{font-weight:800}
    .menu{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
    .menu a{font-size:14px;opacity:.85;color:var(--text)}
    .menu a.active{color:var(--general);font-weight:800;opacity:1}
    .btn,.chip{border-radius:12px;border:1px solid var(--border);padding:10px 14px;background:var(--general);color:#fff;cursor:pointer;font-weight:700}
    .btn.secondary{background:transparent;color:var(--general)}
    .btn.ghost{background:transparent;color:var(--text)}
    .lang,.mode{border:1px solid var(--border);padding:6px 10px;border-radius:10px;background:var(--card);cursor:pointer;font-size:12px}
    .hero{margin-top:16px;border:1px solid var(--border);border-radius:22px;padding:28px;background:
      radial-gradient(800px 300px at 50% -10%, rgba(242,101,34,.15) 0%, transparent 70%),
      linear-gradient(180deg, var(--card) 0%, var(--bg) 100%)}
    .grid{display:grid;gap:24px}
    @media(min-width:900px){.grid-2{grid-template-columns:1.1fr .9fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px}
    .muted{color:var(--muted);font-size:14px}
    .fields{display:grid;gap:14px}
    @media(min-width:720px){.fields-2{grid-template-columns:1fr 1fr}}
    label{display:block;font-size:13px;color:#64748b;margin-bottom:6px}
    :root.dark label{color:#94a3b8}
    select,input,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:var(--text);font-size:14px}
    .section{margin-top:18px}
    .map{height:420px;border-radius:16px;border:1px solid var(--border);overflow:hidden}
    footer{padding:36px 0;text-align:center;color:var(--muted);font-size:12px}
    .badge{display:inline-block;background:var(--accent);border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:12px}
    .steps{display:grid;gap:12px}
    .step{display:flex;gap:10px;align-items:flex-start}
    .num{width:24px;height:24px;border-radius:999px;background:var(--general);color:#fff;display:grid;place-items:center;font-size:12px;font-weight:700}
    .hidden{display:none!important}
    .list{display:grid;gap:10px}
    .item{display:flex;justify-content:space-between;align-items:center;gap:8px;border:1px solid var(--border);border-radius:12px;padding:10px;background:var(--card)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:var(--card);z-index:80}
    .splash.hide{display:none}
    .sCard{border:1px solid var(--border);border-radius:16px;padding:24px;text-align:center;max-width:560px}
    .ico{width:56px;height:56px;border-radius:14px;background:var(--general);display:grid;place-items:center;color:#fff;font-weight:800;font-size:24px;margin:0 auto 12px}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px;z-index:60}
    .modal.open{display:flex}
    .dialog{background:var(--card);border-radius:16px;max-width:520px;width:100%;padding:22px;border:1px solid var(--border)}
    .qr{display:grid;place-items:center;margin-top:10px}
    .admin-grid{display:grid;gap:12px}
    @media(min-width:900px){.admin-grid{grid-template-columns:1fr 1fr}}
    .stat{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--border);border-radius:12px;padding:12px;background:var(--card)}
    .icon{margin-inline-end:6px}
  </style>
</head>
<body>
  <!-- Splash -->
  <div id="splash" class="splash">
    <div class="sCard">
      <div class="ico"><i class="ri-bank-line"></i></div>
      <h3 id="splashTitle" style="margin:6px 0 6px;font-size:22px;font-weight:800;">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØªÙƒ Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h3>
      <div class="muted" id="splashSub">Ø¬Ù…ÙŠØ¹ Ø®Ø¯Ù…Ø§ØªÙƒ Ø§Ù„Ù…ØµØ±ÙÙŠØ© Ø¨Ø§Ù†ØªØ¸Ø§Ø±Ùƒ Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø©.</div>
    </div>
  </div>

  <header>
    <div class="container nav">
      <div class="brand">
        <img id="brandImg" alt="Your General Appointment Platform logo" onerror="this.style.display='none';document.getElementById('logoFallback').style.display='grid';">
        <div id="logoFallback" class="logo-fallback">U</div>
        <div class="title" id="brandTitle">Ù…Ù†ØµØªÙƒ</div>
      </div>
      <nav class="menu">
        <a href="#" class="navlink active" data-target="home" id="navHome"><i class="ri-home-5-line icon"></i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="#" class="navlink" data-target="booking" id="navBooking"><i class="ri-calendar-check-line icon"></i>Ø§Ù„Ø­Ø¬Ø²</a>
        <a href="#" class="navlink" data-target="map" id="navMap"><i class="ri-map-pin-line icon"></i>Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>
        <a href="#" class="navlink" data-target="about" id="navAbout"><i class="ri-information-line icon"></i>Ù…Ù† Ù†Ø­Ù†</a>
        <a href="#" class="navlink" data-target="my" id="navMy"><i class="ri-list-check-2 icon"></i>Ø­Ø¬ÙˆØ²Ø§ØªÙŠ</a>
        <a href="#" class="navlink" data-target="login" id="navLogin"><i class="ri-user-line icon"></i>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
        <a href="#" class="navlink" data-target="support" id="navSupport"><i class="ri-customer-service-2-line icon"></i>Ø§Ù„Ø¯Ø¹Ù…</a>
        <button class="lang" id="langBtn">English</button>
        <button class="mode" id="modeBtn" title="Dark/Light">ğŸŒ™</button>
      </nav>
    </div>
  </header>

  <main id="app"></main>

  <footer>
    <div class="container" id="footerTxt">Â© 2025 Ù…Ù†ØµØªÙƒ Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</div>
  </footer>

  <!-- Success Modal -->
  <div class="modal" id="successModal">
    <div class="dialog">
      <h3 style="margin:0 0 6px;font-weight:800" id="successTitle">ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</h3>
      <div class="muted" id="successDesc">Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø© Ù„Ø­ÙŠÙ† ÙˆØµÙˆÙ„Ùƒ Ù„Ù„ÙØ±Ø¹.</div>
      <div class="qr"><canvas id="qrCanvas"></canvas></div>
      <div class="muted" id="ticketMeta" style="margin-top:8px;font-size:13px"></div>
      <div class="actions" style="justify-content:flex-end;margin-top:12px">
        <button class="btn secondary" id="btnClose">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>

  <script>
    // ===== LOGO SLOT =====
    const LOGO_URL = 'logo.png';
    (function(){
      const img = document.getElementById('brandImg');
      img.src = LOGO_URL;
    })();
  </script>

  <!-- MAIN APP CONTENT -->
  <script>
    const _appHTML = `
      <div class="container">
        <!-- HOME -->
        <section id="home" class="hero grid grid-2">
          <div>
            <div class="badge" id="heroBadge">Ø­Ø¬Ø² Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¢Ù…Ù†</div>
            <h1 id="heroTitle" style="margin:10px 0 8px;font-size:34px;line-height:1.2;font-weight:800">Ø§Ø­Ø¬Ø² Ø¯ÙˆØ±Ùƒ ÙˆØ£Ù†Øª Ø¨Ø¨ÙŠØªÙƒ</h1>
            <p id="heroText" class="muted" style="font-size:15px">
              Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø© / Ø§Ù„ÙØ±Ø¹ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ â€” Ø¨Ø¯ÙˆÙ† Ø·ÙˆØ§Ø¨ÙŠØ± Ø£Ùˆ Ø§Ù†ØªØ¸Ø§Ø±. ÙˆÙØ± ÙˆÙ‚ØªÙƒ ÙˆØ£Ù†Ø¬Ø² Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©.
            </p>
            <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
              <a href="#" class="btn" data-target="booking" id="ctaBook">Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†</a>
              <a href="#" class="btn secondary" data-target="map" id="ctaMap">ÙØ±ÙˆØ¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>
            </div>
            <div class="section steps">
              <div class="step"><div class="num">1</div><div id="st1">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø© / Ø§Ù„ÙØ±Ø¹ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</div></div>
              <div class="step"><div class="num">2</div><div id="st2">Ø­Ø¯Ù‘Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª ÙˆØ£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</div></div>
              <div class="step"><div class="num">3</div><div id="st3">Ø£ÙƒØ¯ Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ø³ØªÙ„Ù… ØªØ°ÙƒØ±ØªÙƒ (QR)</div></div>
            </div>
          </div>
          <div class="card">
            <h3 style="margin:0 0 8px;font-weight:800" id="quickBookTitle">Ø­Ø¬Ø² Ø³Ø±ÙŠØ¹</h3>
            <form id="quickForm" class="fields fields-2">
              <div>
                <label id="lblBank">Ù…Ø²ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                <select id="providerSelect">
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø²ÙˆØ¯</option>
                  <option value="bank">Ø¨Ù†Ùƒ</option>
                  
                </select>
              </div>
              <div>
                <label id="lblBranch">Ø§Ù„Ø¬Ù‡Ø© / Ø§Ù„ÙØ±Ø¹</label>
                <select id="branchSelect"></select>
              </div>
              <div>
                <label id="lblService">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                <select id="serviceSelect"></select>
              </div>
              <div>
                <label id="lblDate">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                <input type="date" id="dateInput">
              </div>
              <div>
                <label id="lblTime">Ø§Ù„ÙˆÙ‚Øª</label>
                <input type="time" id="timeInput">
              </div>
              <div>
                <label id="lblName">Ø§Ù„Ø§Ø³Ù…</label>
                <input id="nameInput" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
              </div>
              <div>
                <label id="lblPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input id="phoneInput" placeholder="07XXXXXXXX">
              </div>
              <div style="grid-column:1/-1;display:flex;justify-content:flex-end;gap:8px">
                <button class="btn" type="submit" id="btnConfirm">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</button>
              </div>
            </form>
          </div>
        </section>

        <!-- BOOKING PAGE -->
        <section id="booking"><button class="btn ghost" onclick="show('home')" style="margin-bottom:10px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button class="section card hidden">
          <h3 style="margin:0 0 10px;font-weight:800" id="bookFullTitle">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø²</h3>
          <p class="muted" id="bookFullText">Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø²Ùƒ.</p>
          <form id="fullForm" class="fields fields-2" style="margin-top:8px">
            <div>
              <label id="lblBank2">Ù…Ø²ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
              <select id="providerSelect2">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø²ÙˆØ¯</option>
                <option value="bank">Ø¨Ù†Ùƒ</option>
                
              </select>
            </div>
            <div>
              <label id="lblBranch2">Ø§Ù„Ø¬Ù‡Ø© / Ø§Ù„ÙØ±Ø¹</label>
              <select id="branchSelect2"></select>
            </div>
            <div>
              <label id="lblService2">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
              <select id="serviceSelect2"></select>
            </div>
            <div>
              <label id="lblDate2">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
              <input type="date" id="dateInput2">
            </div>
            <div>
              <label id="lblTime2">Ø§Ù„ÙˆÙ‚Øª</label>
              <input type="time" id="timeInput2">
            </div>
            <div>
              <label id="lblName2">Ø§Ù„Ø§Ø³Ù…</label>
              <input id="nameInput2" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
            </div>
            <div>
              <label id="lblPhone2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
              <input id="phoneInput2" placeholder="07XXXXXXXX">
            </div>
            <div style="grid-column:1/-1;display:flex;justify-content:flex-end;gap:8px">
              <button class="btn" type="submit" id="btnConfirm2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</button>
            </div>
          </form>
        </section>

        <!-- MAP PAGE -->
        <section id="map"><button class="btn ghost" onclick="show('home')" style="margin-bottom:10px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button class="section card hidden">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
            <h3 style="margin:0;font-weight:800" id="mapTitle">Ø®Ø±ÙŠØ·Ø© ÙØ±ÙˆØ¹ </h3>
            <div style="display:flex;gap:8px"><select id="cityFilter"></select></div>
          </div>
          <div id="mapDiv" class="map" style="margin-top:10px"></div>
          <div class="muted" style="margin-top:8px" id="mapNote">Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶.</div>
        </section>

        <!-- MY APPOINTMENTS -->
        <section id="my"><button class="btn ghost" onclick="show('home')" style="margin-bottom:10px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button class="section card hidden">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="margin:0;font-weight:800" id="myTitle">Ø­Ø¬ÙˆØ²Ø§ØªÙŠ</h3>
            <div class="actions">
              <button class="btn ghost" id="btnExportCsv">CSV</button>
              <button class="btn ghost" id="btnClearAll">ğŸ—‘ï¸</button>
            </div>
          </div>
          <div id="myList" class="list" style="margin-top:10px"></div>
        </section>

        <!-- ABOUT -->
        <section id="about"><button class="btn ghost" onclick="show('home')" style="margin-bottom:10px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button class="section card hidden">
          <h3 style="margin:0 0 10px;font-weight:800" id="aboutTitle">Ø¹Ù† Ø§Ù„Ù…Ù†ØµØ©</h3>
          <p class="muted" id="aboutText">
            Ù†Ø­Ù† ÙÙŠ <strong>Ù…Ù†ØµØªÙƒ Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</strong> Ù†Ø¤Ù…Ù† Ø¨Ø£Ù† Ø§Ù„ÙˆÙ‚Øª Ù‡Ùˆ Ø£Ø«Ù…Ù† Ù…Ø§ ÙŠÙ…Ù„ÙƒÙ‡ Ø§Ù„Ø¥Ù†Ø³Ø§Ù†. Ù„Ø°Ù„Ùƒ Ø£Ù†Ø´Ø£Ù†Ø§ Ù…Ù†ØµØ© Ø±Ù‚Ù…ÙŠØ© Ø°ÙƒÙŠØ© ØªØªÙŠØ­ Ù„Ùƒ Ø­Ø¬Ø² Ù…ÙˆØ§Ø¹ÙŠØ¯Ùƒ Ù„Ø¯Ù‰ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª ÙˆØ§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© ÙÙŠ Ø§Ù„Ø£Ø±Ø¯Ù† Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø© ÙˆØ³Ø±Ø¹Ø©ØŒ Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø£Ùˆ Ø§Ù„ÙˆÙ‚ÙˆÙ ÙÙŠ Ø§Ù„Ø·ÙˆØ§Ø¨ÙŠØ±. Ù‡Ø¯ÙÙ†Ø§ Ù‡Ùˆ ØªØ³Ù‡ÙŠÙ„ Ø­ÙŠØ§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ¬Ø±Ø¨Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø³ÙŠØ·Ø© ÙˆØ¢Ù…Ù†Ø©ØŒ ØªØ¯Ø¹Ù… Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ ÙˆØªØ³Ø§Ù‡Ù… ÙÙŠ ØªØ·ÙˆÙŠØ± Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆØ§Ù„Ø®Ø§ØµØ©. Ù†Ø­Ù† Ù†Ø¹Ù…Ù„ Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¦Ù†Ø§ ÙˆØªÙˆØ³ÙŠØ¹ Ù†Ø·Ø§Ù‚ Ø®Ø¯Ù…Ø§ØªÙ†Ø§ Ù„ØªØ´Ù…Ù„ Ù‚Ø·Ø§Ø¹Ø§Øª Ø£ÙƒØ«Ø±ØŒ Ù…Ø«Ù„ Ø§Ù„Ø¨Ù†ÙˆÙƒØŒ Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø§ØªØµØ§Ù„Ø§ØªØŒ ÙˆØ§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©. Ø±Ø¤ÙŠØªÙ†Ø§ Ù‡ÙŠ Ø£Ù† Ù†ÙƒÙˆÙ† Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© ÙˆØ§Ù„Ø£ÙƒØ«Ø± Ù…ÙˆØ«ÙˆÙ‚ÙŠØ© Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ.
          </p>
          <div class="fields fields-2" style="margin-top:10px">
            <div><label id="lblEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input value="support@monasatak.example" readonly></div>
            <div><label id="lblPhoneC">Ø§Ù„Ù‡Ø§ØªÙ</label><input value="+000-0000000" readonly></div>
          </div>
        </section>

        <!-- LOGIN PAGE -->
        <section id="login"><button class="btn ghost" onclick="show('home')" style="margin-bottom:10px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button class="section card hidden">
          <h3 id="loginTitle" style="margin:0 0 10px;font-weight:800">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
          <form id="loginForm" class="fields" style="max-width:400px;margin:auto">
            <div>
              <label id="loginEmailLabel">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
              <input type="email" id="loginEmail" placeholder="example@email.com">
            </div>
            <div>
              <label id="loginPasswordLabel">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
              <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
              <button class="btn" type="submit" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
              <a href="#" id="guestLogin" class="btn secondary">Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ²Ø§Ø¦Ø±</a>
            </div>
            <div style="margin-top:12px;text-align:center">
              <a href="#" id="createAccount" style="color:var(--general);font-weight:600">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
            </div>
          </form>
        </section>

        <!-- SUPPORT PAGE -->
        <section id="support"><button class="btn ghost" onclick="show('home')" style="margin-bottom:10px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button class="section card hidden">
          <h3 style="margin:0 0 10px;font-weight:800" id="supportTitle">Ø®Ø¯Ù…Ø© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø°ÙƒÙŠ</h3>
          <div id="quickQuestions" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;"></div>
          <div id="chatBox" style="border:1px solid var(--border);border-radius:12px;padding:12px;height:350px;overflow-y:auto;background:var(--card)"></div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <input id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." style="flex:1;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--card)">
            <button class="btn" id="sendChat">Ø¥Ø±Ø³Ø§Ù„</button>
          </div>
        </section>

        <!-- ADMIN PAGE (OPTIONAL) -->
        <section id="admin"><button class="btn ghost" onclick="show('home')" style="margin-bottom:10px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button class="section card hidden">
          <h3 style="margin:0 0 10px;font-weight:800" id="adminTitle">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
          <div id="adminStats" class="admin-grid"></div>
          <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
            <button class="btn ghost" id="btnExportAdminCsv">Export CSV</button>
          </div>
        </section>
      </div>
    `;
    document.getElementById('app').innerHTML = _appHTML;
  </script>

  <!-- LOGIC + I18N -->
  <script>
    const i18n = {
      ar: {
        splashTitle:"Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØªÙƒ Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",
        splashSub:"Ø¬Ù…ÙŠØ¹ Ø®Ø¯Ù…Ø§ØªÙƒ Ø§Ù„Ù…ØµØ±ÙÙŠØ© Ø¨Ø§Ù†ØªØ¸Ø§Ø±Ùƒ Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø©.",
        brand:"Ù…Ù†ØµØªÙƒ Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ â€” Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",
        nav:["Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©","Ø§Ù„Ø­Ø¬Ø²","Ø§Ù„Ø®Ø±ÙŠØ·Ø©","Ù…Ù† Ù†Ø­Ù†","Ø­Ø¬ÙˆØ²Ø§ØªÙŠ","ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„","Ø§Ù„Ø¯Ø¹Ù…"],
        langBtn:"English",
        mode:"Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ",
        heroBadge:"Ø­Ø¬Ø² Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¢Ù…Ù†",
        heroTitle:"Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ ÙÙŠ  Ù…Ù† Ø£ÙŠ Ù…ÙƒØ§Ù†",
        heroText:"Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø© / Ø§Ù„ÙØ±Ø¹ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ â€” Ø¨Ø¯ÙˆÙ† Ø·ÙˆØ§Ø¨ÙŠØ± Ø£Ùˆ Ø§Ù†ØªØ¸Ø§Ø±. ÙˆÙØ± ÙˆÙ‚ØªÙƒ ÙˆØ£Ù†Ø¬Ø² Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©.",
        ctaBook:"Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†",
        ctaMap:"ÙØ±ÙˆØ¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©",
        steps:["Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø© / Ø§Ù„ÙØ±Ø¹ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©","Ø­Ø¯Ù‘Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª ÙˆØ£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ","Ø£ÙƒØ¯ Ø§Ù„Ø­Ø¬Ø² ÙˆØ§Ø³ØªÙ„Ù… ØªØ°ÙƒØ±ØªÙƒ (QR)"],
        quick:"Ø­Ø¬Ø² Ø³Ø±ÙŠØ¹",
        labels:{bank:"Ù…Ø²ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø©",branch:"Ø§Ù„Ø¬Ù‡Ø© / Ø§Ù„ÙØ±Ø¹",service:"Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©",date:"Ø§Ù„ØªØ§Ø±ÙŠØ®",time:"Ø§Ù„ÙˆÙ‚Øª",name:"Ø§Ù„Ø§Ø³Ù…",phone:"Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"},
        confirm:"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²",
        bookTitle:"Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø²",
        bookText:"Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø²Ùƒ.",
        mapTitle:"Ø®Ø±ÙŠØ·Ø© ÙØ±ÙˆØ¹ ",
        mapNote:"Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶.",
        myTitle:"Ø­Ø¬ÙˆØ²Ø§ØªÙŠ",
        about:"Ø¹Ù† Ø§Ù„Ù…Ù†ØµØ©",
        aboutText:"Ù†Ø­Ù† ÙÙŠ <strong>Ù…Ù†ØµØªÙƒ Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</strong> Ù†Ø¤Ù…Ù† Ø¨Ø£Ù† Ø§Ù„ÙˆÙ‚Øª Ù‡Ùˆ Ø£Ø«Ù…Ù† Ù…Ø§ ÙŠÙ…Ù„ÙƒÙ‡ Ø§Ù„Ø¥Ù†Ø³Ø§Ù†. Ù„Ø°Ù„Ùƒ Ø£Ù†Ø´Ø£Ù†Ø§ Ù…Ù†ØµØ© Ø±Ù‚Ù…ÙŠØ© Ø°ÙƒÙŠØ© ØªØªÙŠØ­ Ù„Ùƒ Ø­Ø¬Ø² Ù…ÙˆØ§Ø¹ÙŠØ¯Ùƒ Ù„Ø¯Ù‰ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª ÙˆØ§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© ÙÙŠ Ø§Ù„Ø£Ø±Ø¯Ù† Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø© ÙˆØ³Ø±Ø¹Ø©ØŒ Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø£Ùˆ Ø§Ù„ÙˆÙ‚ÙˆÙ ÙÙŠ Ø§Ù„Ø·ÙˆØ§Ø¨ÙŠØ±. Ù‡Ø¯ÙÙ†Ø§ Ù‡Ùˆ ØªØ³Ù‡ÙŠÙ„ Ø­ÙŠØ§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ¬Ø±Ø¨Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø³ÙŠØ·Ø© ÙˆØ¢Ù…Ù†Ø©ØŒ ØªØ¯Ø¹Ù… Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ ÙˆØªØ³Ø§Ù‡Ù… ÙÙŠ ØªØ·ÙˆÙŠØ± Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆØ§Ù„Ø®Ø§ØµØ©. Ù†Ø­Ù† Ù†Ø¹Ù…Ù„ Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¦Ù†Ø§ ÙˆØªÙˆØ³ÙŠØ¹ Ù†Ø·Ø§Ù‚ Ø®Ø¯Ù…Ø§ØªÙ†Ø§ Ù„ØªØ´Ù…Ù„ Ù‚Ø·Ø§Ø¹Ø§Øª Ø£ÙƒØ«Ø±ØŒ Ù…Ø«Ù„ Ø§Ù„Ø¨Ù†ÙˆÙƒØŒ Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø§ØªØµØ§Ù„Ø§ØªØŒ ÙˆØ§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©. Ø±Ø¤ÙŠØªÙ†Ø§ Ù‡ÙŠ Ø£Ù† Ù†ÙƒÙˆÙ† Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© ÙˆØ§Ù„Ø£ÙƒØ«Ø± Ù…ÙˆØ«ÙˆÙ‚ÙŠØ© Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ.",
        email:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
        phone:"Ø§Ù„Ù‡Ø§ØªÙ",
        footer:"Â© 2025 Ù…Ù†ØµØªÙƒ Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.",
        successTitle:"ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²",
        successDesc:"Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø© Ù„Ø­ÙŠÙ† ÙˆØµÙˆÙ„Ùƒ Ù„Ù„ÙØ±Ø¹.",
        close:"Ø¥ØºÙ„Ø§Ù‚",
        csv:"CSV",
        clear:"Ø­Ø°Ù Ø§Ù„ÙƒÙ„",
        actions:{qr:"Ø¹Ø±Ø¶ QR",ics:"Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªÙ‚ÙˆÙŠÙ…",share:"Ù…Ø´Ø§Ø±ÙƒØ©",del:"Ø­Ø°Ù"},
        admin:"Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",
        export:"ØªØµØ¯ÙŠØ± CSV",
        citiesAll:"ÙƒÙ„ Ø§Ù„Ù…Ø¯Ù†",
        notifyGranted:"ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­.",
        notifyDenied:"Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª.",
        // login / support
        loginTitle:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
        loginEmailLabel:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
        loginPasswordLabel:"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
        loginEmailPh:"example@email.com",
        loginPasswordPh:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",
        loginBtn:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
        guestBtn:"Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ²Ø§Ø¦Ø±",
        createAccount:"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯",
        supportTitle:"Ø®Ø¯Ù…Ø© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø°ÙƒÙŠ",
        supportPlaceholder:"Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§...",
        supportSend:"Ø¥Ø±Ø³Ø§Ù„",
        supportQuestions:[
          "ÙƒÙŠÙ Ø£Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ØŸ",
          "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©ØŸ",
          "Ù‡Ù„ Ø£Ø³ØªØ·ÙŠØ¹ ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¹Ø¯ÙŠØŸ",
          "Ø£ÙŠÙ† Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØŸ",
          "Ø¹Ù†Ø¯ÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
          "Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„",
          "Ù‡Ù„ Ø§Ù„Ù…Ù†ØµØ© ØªØ§Ø¨Ø¹Ø© Ù„Ø¨Ù†ÙƒØŸ",
          "ÙƒÙŠÙ Ø£ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…ØŸ"
        ],
        conflictMsg:"Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø¬Ø² Ø£ÙƒØ«Ø± Ù…Ù† Ù…ÙˆØ¹Ø¯ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª. ÙŠÙˆØ¬Ø¯ Ø­Ø¬Ø² Ø¢Ø®Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª.",
        fillAll:"ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„",
        phoneInvalid:"Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 07 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 10 Ø£Ø±Ù‚Ø§Ù…",
        noBookings:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ø¹Ø¯."
      },
      en: {
        splashTitle:"Welcome to Your General Appointment Platform",
        splashSub:"Your banking services are ready â€” hassle-free.",
        brand:"Your General Appointment Platform â€” Appointments",
        nav:["Home","Booking","Map","About","My Appointments","Login","Support"],
        langBtn:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
        mode:"Dark Mode",
        heroBadge:"Secure online booking",
        heroTitle:"Book your Your General Appointment Platform appointment from anywhere",
        heroText:"Choose branch, service, date and time â€” skip queues and save your time.",
        ctaBook:"Book Now",
        ctaMap:"Branches Map",
        steps:["Choose branch & service","Pick date/time and enter details","Confirm & get your QR ticket"],
        quick:"Quick Booking",
        labels:{bank:"Provider",branch:"Branch",service:"Service",date:"Date",time:"Time",name:"Full name",phone:"Mobile"},
        confirm:"Confirm Booking",
        bookTitle:"Booking Form",
        bookText:"Fill in the following to confirm your booking.",
        mapTitle:"Your General Appointment Platform Branches Map",
        mapNote:"Locations are approximate for demo purposes.",
        myTitle:"My Appointments",
        about:"About",
        aboutText:"At <strong>Your General Appointment Platform</strong>, we believe that time is your most valuable asset. That is why we built a smart digital platform that lets you book appointments with different institutions and organizations in Jordan easily and quickly, without waiting in queues. Our goal is to simplify your daily life through a simple and secure user experience that supports digital transformation and improves public and private services. We continuously enhance our platform and expand our services to cover more sectors such as banks, telecom companies, and government entities. Our vision is to be the most trusted and unified platform for online appointment booking in the Arab world.",
        email:"Email",
        phone:"Phone",
        footer:"Â© 2025 Your General Appointment Platform â€” All rights reserved.",
        successTitle:"Booking Confirmed",
        successDesc:"Keep this ticket and present it upon arrival.",
        close:"Close",
        csv:"CSV",
        clear:"Clear all",
        actions:{qr:"Show QR",ics:"Add to Calendar",share:"Share",del:"Delete"},
        admin:"Admin Dashboard",
        export:"Export CSV",
        citiesAll:"All cities",
        notifyGranted:"Reminders enabled for this browser.",
        notifyDenied:"Notifications are blocked.",
        // login / support
        loginTitle:"Login",
        loginEmailLabel:"Email",
        loginPasswordLabel:"Password",
        loginEmailPh:"example@email.com",
        loginPasswordPh:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",
        loginBtn:"Login",
        guestBtn:"Continue as Guest",
        createAccount:"Create a new account",
        supportTitle:"Smart Support Service",
        supportPlaceholder:"Type your question here...",
        supportSend:"Send",
        supportQuestions:[
          "How do I book an appointment?",
          "What services are available?",
          "Can I edit my booking?",
          "Where is the main branch?",
          "I have a problem with registration",
          "Working hours",
          "Is this platform part of a bank?",
          "How can I contact support?"
        ],
        conflictMsg:"You cannot book two appointments at the same time. There is already an appointment at this time.",
        fillAll:"Please fill all required fields",
        phoneInvalid:"Mobile must start with 07 and be 10 digits",
        noBookings:"No appointments yet."
      }
    };

    let lang = 'ar';
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    function t(){ return i18n[lang]; }

    function applyLang(){
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

      $('#splashTitle').textContent = t().splashTitle;
      $('#splashSub').textContent = t().splashSub;
      $('#brandTitle').textContent = t().brand;
      [$('#navHome'),$('#navBooking'),$('#navMap'),$('#navAbout'),$('#navMy'),$('#navLogin'),$('#navSupport')]
        .forEach((el,i)=>{ if(el) el.textContent = t().nav[i]; });
      $('#langBtn').textContent = t().langBtn;

      $('#heroBadge').textContent = t().heroBadge;
      $('#heroTitle').textContent = t().heroTitle;
      $('#heroText').textContent = t().heroText;
      $('#ctaBook').textContent = t().ctaBook;
      $('#ctaMap').textContent = t().ctaMap;
      [$('#st1'),$('#st2'),$('#st3')].forEach((el,i)=> el && (el.textContent = t().steps[i]));
      $('#quickBookTitle').textContent = t().quick;

      const L = t().labels;
      ['lblBank','lblBranch','lblService','lblDate','lblTime','lblName','lblPhone']
        .forEach((id,i)=> $('#'+id).textContent = [L.bank,L.branch,L.service,L.date,L.time,L.name,L.phone][i]);
      ['lblBank2','lblBranch2','lblService2','lblDate2','lblTime2','lblName2','lblPhone2']
        .forEach((id,i)=> $('#'+id).textContent = [L.bank,L.branch,L.service,L.date,L.time,L.name,L.phone][i]);

      $('#btnConfirm').textContent = t().confirm;
      $('#btnConfirm2').textContent = t().confirm;
      $('#bookFullTitle').textContent = t().bookTitle;
      $('#bookFullText').textContent = t().bookText;
      $('#mapTitle').textContent = t().mapTitle;
      $('#mapNote').textContent = t().mapNote;
      $('#aboutTitle').textContent = t().about;
      $('#aboutText').innerHTML = t().aboutText;
      $('#lblEmail').textContent = t().email;
      $('#lblPhoneC').textContent = t().phone;
      $('#footerTxt').textContent = t().footer;
      $('#successTitle').textContent = t().successTitle;
      $('#successDesc').textContent = t().successDesc;
      $('#btnClose').textContent = t().close;
      $('#myTitle').textContent = t().myTitle;
      $('#btnExportCsv').textContent = t().csv;
      $('#btnClearAll').textContent = t().clear;
      const firstCity = $('#cityFilter') && $('#cityFilter').querySelector('option');
      if(firstCity) firstCity.textContent = t().citiesAll;
      $('#adminTitle').textContent = t().admin;
      $('#btnExportAdminCsv').textContent = t().export;

      // Login
      $('#loginTitle').textContent = t().loginTitle;
      $('#loginEmailLabel').textContent = t().loginEmailLabel;
      $('#loginPasswordLabel').textContent = t().loginPasswordLabel;
      $('#loginBtn').textContent = t().loginBtn;
      $('#guestLogin').textContent = t().guestBtn;
      $('#createAccount').textContent = t().createAccount;
      $('#loginEmail').placeholder = t().loginEmailPh;
      $('#loginPassword').placeholder = t().loginPasswordPh;

      // Support
      $('#supportTitle').textContent = t().supportTitle;
      $('#chatInput').placeholder = t().supportPlaceholder;
      $('#sendChat').textContent = t().supportSend;


      // Update provider select option labels
      ['providerSelect','providerSelect2'].forEach(pid=>{
        const sel = document.getElementById(pid);
        if(sel && sel.options.length){
          const first = sel.options[0];
          first.textContent = (lang === 'ar') ? 'Ø§Ø®ØªØ± Ø§Ù„Ù…Ø²ÙˆØ¯' : 'Select provider';
          if(sel.options.length > 1){
            const bankOpt = sel.options[1];
            bankOpt.textContent = (lang === 'ar') ? 'Ø¨Ù†Ùƒ' : 'Bank';
          }
        }
      });
      // Update booking placeholders for name / phone
      const name1 = document.getElementById('nameInput');
      const name2 = document.getElementById('nameInput2');
      const phone1 = document.getElementById('phoneInput');
      const phone2 = document.getElementById('phoneInput2');
      if(name1) name1.placeholder = (lang === 'ar') ? 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ' : 'Full name';
      if(name2) name2.placeholder = (lang === 'ar') ? 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ' : 'Full name';
      if(phone1) phone1.placeholder = (lang === 'ar') ? '07XXXXXXXX' : 'Mobile number';
      if(phone2) phone2.placeholder = (lang === 'ar') ? '07XXXXXXXX' : 'Mobile number';

      // Update branch selects labels after language switch
      ['branchSelect','branchSelect2'].forEach(id=>{
        const sel = document.getElementById(id);
        if(sel){
          Array.from(sel.options).forEach(o=>{
            const city = o.dataset.city || '';
            const name = o.dataset.name || o.value;
            if(city){
              const cityLabel = translateCityName(city);
              const branchLabel = translateBranchName(name);
              o.textContent = cityLabel+' â€” '+branchLabel;
            }
          });
        }
      });

      // Update city filter text options
      const citySel = document.getElementById('cityFilter');
      if(citySel){
        Array.from(citySel.options).forEach(o=>{
          if(o.value === ''){
            o.textContent = t().citiesAll;
          } else if(o.dataset.city){
            o.textContent = translateCityName(o.dataset.city);
          }
        });
      }

      const qq = $('#quickQuestions');
      if(qq){
        qq.innerHTML = '';
        t().supportQuestions.forEach(qText=>{
          const b = document.createElement('button');
          b.className = 'chip';
          b.textContent = qText;
          qq.appendChild(b);
        });
        attachQuickQuestionHandlers();
      }
    }

    function show(id){
      ['home','booking','map','about','my','admin','login','support']
        .forEach(x => { const el = $('#'+x); if(el) el.classList.add('hidden'); });
      const target = $('#'+id);
      if(target) target.classList.remove('hidden');

      $$('.navlink').forEach(a=>a.classList.remove('active'));
      const link = $$('.navlink').find(a=>a.dataset.target === id);
      if(link) link.classList.add('active');

      if(id === 'map') setTimeout(initMapIfNeeded,0);
      if(id === 'my') renderMy();
      if(id === 'admin') renderAdmin();

      location.hash = id;
    }

    window.addEventListener('hashchange',()=>{
      const id = location.hash.replace('#','') || 'home';
      show(id);
    });

    $$('.navlink, [data-target]').forEach(el=>{
      el.addEventListener('click',e=>{
        e.preventDefault();
        const id = el.dataset.target;
        if(id) show(id);
      });
    });

    // BRANCHES
    const BRANCHES = [
      {city:'Ø¹Ù…Ù‘Ø§Ù†',name:'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ',lat:31.95,lng:35.91,crowd:1},
      {city:'Ø¹Ù…Ù‘Ø§Ù†',name:'Ø¨Ù†Ùƒ Ø§Ù„Ø§Ø³ÙƒØ§Ù†',lat:31.96,lng:35.90,crowd:2},
      {city:'Ø¹Ù…Ù‘Ø§Ù†',name:'Ø¨Ù†Ùƒ Ø§Ù„Ø§ØªØ­Ø§Ø¯',lat:31.97,lng:35.92,crowd:1},
      {city:'Ø¹Ù…Ù‘Ø§Ù†',name:'Ø¨Ù†Ùƒ Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© Ø¹Ù…Ø§Ù†',lat:31.94,lng:35.93,crowd:2},
      {city:'Ø¹Ù…Ù‘Ø§Ù†',name:'ÙƒØ§Ø¨ÙŠØªÙ„ Ø¨Ù†Ùƒ',lat:31.93,lng:35.89,crowd:3}
    ];
    const CITIES = [...new Set(BRANCHES.map(b=>b.city))].sort();
    const CITY_EN = {
      "Ø¹Ù…Ù‘Ø§Ù†":"Amman"
    };
    const BRANCH_NAME_EN = {
      "Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ":"Arab Bank",
      "Ø¨Ù†Ùƒ Ø§Ù„Ø§Ø³ÙƒØ§Ù†":"Housing Bank",
      "Ø¨Ù†Ùƒ Ø§Ù„Ø§ØªØ­Ø§Ø¯":"Etihad Bank",
      "Ø¨Ù†Ùƒ Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© Ø¹Ù…Ø§Ù†":"Cairo Amman Bank",
      "ÙƒØ§Ø¨ÙŠØªÙ„ Ø¨Ù†Ùƒ":"Capital Bank"
    };
    const SERVICE_EN = {
      "Ø³Ø­Ø¨ ÙˆØ¥ÙŠØ¯Ø§Ø¹":"Cash deposit/withdrawal",
      "ØµØ±Ù Ø´ÙŠÙƒØ§Øª":"Cheque cashing",
      "ÙØªØ­ Ø­Ø³Ø§Ø¨":"Open account",
      "ØªØ­ÙˆÙŠÙ„Ø§Øª Ù…Ø§Ù„ÙŠØ©":"Money transfers",
      "Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ø±ØµÙŠØ¯":"Balance inquiry",
      "Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±":"Technical support"
    };

    function translateCityName(name){
      if(lang === 'en') return CITY_EN[name] || name;
      return name;
    }
    function translateBranchName(name){
      if(lang === 'en') return BRANCH_NAME_EN[name] || name;
      return name;
    }
    function translateServiceName(name){
      if(lang === 'en'){
        return SERVICE_EN[name] || name;
      }
      return name;
    }


    function fillBranches(id){
      const sel = document.querySelector(id);
      if(!sel) return;
      sel.innerHTML = '';
      BRANCHES.forEach(b=>{
        const o = document.createElement('option');
        o.value = b.name;
        o.dataset.city = b.city;
        o.dataset.name = b.name;
        const cityLabel = translateCityName(b.city);
        const branchLabel = translateBranchName(b.name);
        o.textContent = cityLabel+' â€” '+branchLabel;
        sel.appendChild(o);
      });
    }
    function fillCities(){
      const citySel = $('#cityFilter');
      if(!citySel) return;
      citySel.innerHTML='';
      const optAll = document.createElement('option');
      optAll.value='';
      optAll.textContent = t().citiesAll;
      citySel.appendChild(optAll);
      CITIES.forEach(c=>{
        const o = document.createElement('option');
        o.value=c;
        o.dataset.city = c;
        o.textContent = translateCityName(c);
        citySel.appendChild(o);
      });
      citySel.onchange = refreshMap;
    }

    function tomorrowISO(){
      return new Date(Date.now()+24*3600*1000).toISOString().slice(0,10);
    }
    function setDefaults(){
      const d = tomorrowISO();
      const di1 = $('#dateInput'), di2 = $('#dateInput2');
      if(di1) di1.value = d;
      if(di2) di2.value = d;
    }
    function idGen(){
      return 'U'+Math.random().toString(36).slice(2,8).toUpperCase()+Date.now().toString(36).toUpperCase();
    }

    function createBooking(q){
      const g = id => document.getElementById(id).value;
      const b = {
        id:idGen(),
        bankId:'general',
        branch:g(q?'branchSelect':'branchSelect2'),
        service:g(q?'serviceSelect':'serviceSelect2'),
        date:g(q?'dateInput':'dateInput2'),
        time:g(q?'timeInput':'timeInput2'),
        name:g(q?'nameInput':'nameInput2').trim(),
        phone:g(q?'phoneInput':'phoneInput2').trim(),
        createdAt:new Date().toISOString(),
        reminderMinutes:60,
        notified:false
      };
      if(!b.name || !b.phone || !b.date || !b.time || !b.branch || !b.service){
        alert(t().fillAll);
        return null;
      }
      if(!/^07\d{8}$/.test(b.phone)){
        alert(t().phoneInvalid);
        return null;
      }
      return b;
    }

    function getBookings(){
      return JSON.parse(localStorage.getItem('beu_bookings') || '[]');
    }
    function setBookings(list){
      localStorage.setItem('beu_bookings', JSON.stringify(list));
    }

    function hasTimeConflict(b){
      const list = getBookings();
      return list.some(x => x.date === b.date && x.time === b.time);
    }

    function saveBooking(b){
      const key='beu_bookings';
      const list=JSON.parse(localStorage.getItem(key)||'[]');
      list.push(b);
      localStorage.setItem(key, JSON.stringify(list));
    }

    function onSubmit(e,q){
      e.preventDefault();
      const b = createBooking(q);
      if(!b) return;
      if(hasTimeConflict(b)){
        alert(t().conflictMsg);
        return;
      }
      saveBooking(b);
      renderSuccess(b);
      scheduleReminders();
      renderMy();
    }

    document.addEventListener('submit', function(e){
      if(e.target && e.target.id==='quickForm'){ onSubmit(e,true); }
      if(e.target && e.target.id==='fullForm'){ onSubmit(e,false); }
    });

    function renderSuccess(b){
      $('#successTitle').textContent = t().successTitle;
      $('#successDesc').textContent = t().successDesc;
      const branchLabel = translateBranchName(b.branch.split('â€”').pop().trim() || b.branch);
      const serviceLabel = translateServiceName(b.service);
      $('#ticketMeta').textContent = `${branchLabel} â€¢ ${serviceLabel} â€¢ ${b.date} ${b.time}`;
      $('#successModal').classList.add('open');
      QRCode.toCanvas($('#qrCanvas'), JSON.stringify(b), {width:180});
    }
    $('#btnClose').addEventListener('click',()=>$('#successModal').classList.remove('open'));

    function padEndTime(time,mins){
      const [h,m] = time.split(':').map(Number);
      const d = new Date();
      d.setHours(h,m+mins,0,0);
      return d.toTimeString().slice(0,5).replace(':','');
    }

    function downloadICS(b){
      const dt=(d,t)=>d.replace(/-/g,'')+'T'+t.replace(':','')+'00';
      const body=[
        'BEGIN:VCALENDAR',
        'VERSION:2.0',
        'PRODID:-//Your General Appointment Platform//Appointments//EN',
        'CALSCALE:GREGORIAN',
        'METHOD:PUBLISH',
        'BEGIN:VEVENT',
        'UID:'+b.id+'@beu',
        'DTSTAMP:'+new Date().toISOString().replace(/[-:]/g,'').split('.')[0]+'Z',
        'DTSTART:'+dt(b.date,b.time),
        'DTEND:'+dt(b.date, padEndTime(b.time,30)),
        'SUMMARY:Appointment â€” '+b.branch,
        'DESCRIPTION:Your General Appointment Platform â€” '+b.service+' â€” Ticket '+b.id,
        'LOCATION:'+b.branch,
        'END:VEVENT',
        'END:VCALENDAR'
      ].join('\r\n');
      const blob = new Blob([body],{type:'text/calendar;charset=utf-8'});
      const a = document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='appointment.ics';
      a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href),1000);
    }

    function mkBtn(text,fn){
      const b=document.createElement('button');
      b.className='btn ghost';
      b.textContent=text;
      b.onclick=fn;
      return b;
    }

    function renderMy(){
      const wrap = $('#myList');
      if(!wrap) return;
      wrap.innerHTML='';
      const list = getBookings().sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time));
      if(!list.length){
        wrap.innerHTML=`<div class="muted">${t().noBookings}</div>`;
        return;
      }
      list.forEach(b=>{
        const div=document.createElement('div');
        div.className='item';
        const left=document.createElement('div');
        let branchDisplay = b.branch;
        // Try to extract branch name after dash if stored as "city â€” name"
        if(lang === 'en'){
          const parts = b.branch.split('â€”');
          if(parts.length === 2){
            const cityAr = parts[0].trim();
            const nameAr = parts[1].trim();
            const cityLabel = translateCityName(cityAr);
            const branchLabel = translateBranchName(nameAr);
            branchDisplay = cityLabel+' â€” '+branchLabel;
          } else {
            branchDisplay = translateBranchName(b.branch);
          }
        }
        const serviceDisplay = translateServiceName(b.service);
        left.innerHTML = `
          <div style="font-weight:700">${branchDisplay}</div>
          <div class="muted" style="font-size:13px">${serviceDisplay} â€¢ ${b.date} ${b.time}</div>
          <div class="muted" style="font-size:12px">#${b.id}</div>
        `;
        const act=document.createElement('div');
        act.className='actions';
        const btnQR=mkBtn(t().actions.qr,()=>{
          $('#successModal').classList.add('open');
          $('#ticketMeta').textContent = `${b.branch} â€¢ ${b.service} â€¢ ${b.date} ${b.time}`;
          QRCode.toCanvas($('#qrCanvas'), JSON.stringify(b), {width:180});
        });
        const btnICS=mkBtn(t().actions.ics,()=>downloadICS(b));
        const btnShare=mkBtn(t().actions.share,()=>shareBooking(b));
        const btnDel=mkBtn(t().actions.del,()=>{
          const arr=getBookings().filter(x=>x.id!==b.id);
          setBookings(arr);
          renderMy();
        });
        act.append(btnQR,btnICS,btnShare,btnDel);
        div.append(left,act);
        wrap.appendChild(div);
      });
    }

    function exportCSV(rows,name){
      const csv = rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob=new Blob([csv],{type:'text/csv'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download=name;
      a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href),1000);
    }

    document.addEventListener('click', function(e){
      if(e.target && e.target.id==='btnExportCsv'){
        const list=getBookings();
        const rows=[['id','branch','service','date','time','name','phone']]
          .concat(list.map(b=>[b.id,b.branch,b.service,b.date,b.time,b.name,b.phone]));
        exportCSV(rows,'appointments.csv');
      }
      if(e.target && e.target.id==='btnClearAll'){
        if(confirm(lang==='ar'?'ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§ØªØŸ':'Clear all appointments?')){
          setBookings([]);
          renderMy();
        }
      }
      if(e.target && e.target.id==='btnExportAdminCsv'){
        const list=getBookings();
        const rows=[['id','branch','service','date','time','name','phone','createdAt']]
          .concat(list.map(b=>[b.id,b.branch,b.service,b.date,b.time,b.name,b.phone,b.createdAt]));
        exportCSV(rows,'admin_report.csv');
      }
    });

    async function shareBooking(b){
      const text = (lang==='ar'
        ? `Ù…ÙˆØ¹Ø¯  â€” ${b.branch}\nÙ†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©: ${b.service}\n${b.date} ${b.time}\nÙƒÙˆØ¯: ${b.id}`
        : `Your General Appointment Platform appointment â€” ${b.branch}\nService: ${b.service}\n${b.date} ${b.time}\nTicket: ${b.id}`);
      if(navigator.share){
        try{ await navigator.share({text}); }catch(e){}
      } else {
        const url='https://wa.me/?text='+encodeURIComponent(text);
        window.open(url,'_blank');
      }
    }

    let map,markersLayer;
    function initMapIfNeeded(){
      if(map){ refreshMap(); return; }
      map = L.map('mapDiv').setView([31.95,35.91],6);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
      markersLayer=L.layerGroup().addTo(map);
      refreshMap();
    }
    function crowdColor(c){return c>=3?'red':(c==2?'orange':'green');}
    function refreshMap(){
      if(!markersLayer) return;
      markersLayer.clearLayers();
      const city=$('#cityFilter').value;
      const list=BRANCHES.filter(b=>!city||b.city===city);
      list.forEach(b=>{
        const cityLabel = translateCityName(b.city);
        const branchLabel = translateBranchName(b.name);
        L.circleMarker([b.lat,b.lng],{radius:8,color:crowdColor(b.crowd)})
          .addTo(markersLayer)
          .bindPopup(`<b>${lang==='ar'?'':'Your General Appointment Platform'}</b><br>${cityLabel} â€” ${branchLabel}<br>${lang==='ar'?'Ø§Ù„Ø§Ø²Ø¯Ø­Ø§Ù…':'Crowd'}: ${b.crowd}`);
      });
      if(list.length){
        const bounds=L.latLngBounds(list.map(b=>[b.lat,b.lng]));
        map.fitBounds(bounds.pad(0.2));
      }
    }

    function renderAdmin(){
      const box=$('#adminStats');
      if(!box) return;
      box.innerHTML='';
      const list=getBookings();
      const byDay={};
      list.forEach(b=>{byDay[b.date]=(byDay[b.date]||0)+1;});
      const byBranch={};
      list.forEach(b=>{byBranch[b.branch]=(byBranch[b.branch]||0)+1;});
      for(const [k,v] of Object.entries(byDay)){
        box.appendChild(statItem((lang==='ar'?'Ø­Ø¬ÙˆØ²Ø§Øª ÙŠÙˆÙ… ':'Day ')+k,v));
      }
      for(const [k,v] of Object.entries(byBranch)){
        box.appendChild(statItem((lang==='ar'?'Ø­Ø¬ÙˆØ²Ø§Øª ÙØ±Ø¹ ':'Branch ')+k,v));
      }
    }
    function statItem(label,val){
      const d=document.createElement('div');
      d.className='stat';
      d.innerHTML=`<div>${label}</div><div style="font-weight:800">${val}</div>`;
      return d;
    }

    function scheduleReminders(){
      if(!('Notification' in window)) return;
      if(Notification.permission==='default'){
        Notification.requestPermission().then(p=>{
          alert(p==='granted'?t().notifyGranted:t().notifyDenied);
        });
      }
      clearInterval(window.__remTimer);
      window.__remTimer=setInterval(()=>{
        const list=getBookings();
        const now=new Date();
        list.forEach(b=>{
          if(b.notified) return;
          const dt=new Date(b.date+'T'+b.time);
          const diff=dt-now;
          const mins=b.reminderMinutes||60;
          if(diff>0 && diff<mins*60*1000){
            new Notification(t().brand,{
              body:(lang==='ar'?'ØªØ°ÙƒÙŠØ± Ø¨Ù…ÙˆØ¹Ø¯Ùƒ ÙÙŠ ':'Reminder: ')+b.branch+' â€” '+b.date+' '+b.time
            });
            b.notified=true;
          }
        });
        setBookings(list);
      },60*1000);
    }

    // Dynamic Service Provider Logic
    function updateServices(selectId, serviceSelectId){
      const provider = document.getElementById(selectId).value;
      const serviceSelect = document.getElementById(serviceSelectId);
      if(!serviceSelect) return;
      serviceSelect.innerHTML='';
      let options=[];
      if(provider === 'bank'){
        options = lang==='ar'
          ? ['Ø³Ø­Ø¨ ÙˆØ¥ÙŠØ¯Ø§Ø¹','ØµØ±Ù Ø´ÙŠÙƒØ§Øª','ÙØªØ­ Ø­Ø³Ø§Ø¨','ØªØ­ÙˆÙŠÙ„Ø§Øª Ù…Ø§Ù„ÙŠØ©','Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ø±ØµÙŠØ¯','Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±']
          : ['Cash deposit/withdrawal','Cheque cashing','Open account','Money transfers','Balance inquiry','Technical support'];
      } else if(false){
        options = lang==='ar'
          ? ['Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ','Ø¯ÙØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±','ÙØªØ­ Ø®Ø· Ø¬Ø¯ÙŠØ¯','ØªØ¨Ø¯ÙŠÙ„ SIM','ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯','Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±']
          : ['Balance inquiry','Bill payment','New line activation','SIM replacement','Credit transfer','Technical support'];
      } else {
        options = [lang==='ar'?'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø²ÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹':'Please choose a provider first'];
      }
      options.forEach(o=>{
        const opt=document.createElement('option');
        opt.textContent=o;
        serviceSelect.appendChild(opt);
      });
    }

    ['providerSelect','providerSelect2'].forEach(id=>{
      const serviceId = id === 'providerSelect' ? 'serviceSelect' : 'serviceSelect2';
      const el=document.getElementById(id);
      if(el) el.addEventListener('change',()=>updateServices(id,serviceId));
    });

    // Chat support
    const chatBox = document.getElementById('chatBox');
    const chatInput = document.getElementById('chatInput');
    const sendChat = document.getElementById('sendChat');

    function appendMsg(text,sender='bot'){
      const msg=document.createElement('div');
      msg.style.margin='6px 0';
      msg.style.textAlign = sender === 'bot' ? 'right' : 'left';
      msg.innerHTML = sender === 'bot'
        ? `<div style="background:var(--general);color:#fff;display:inline-block;padding:8px 12px;border-radius:12px;max-width:80%">${text}</div>`
        : `<div style="background:var(--accent);color:var(--text);display:inline-block;padding:8px 12px;border-radius:12px;max-width:80%">${text}</div>`;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function aiReply(userText){
      const txt = userText.trim();
      if(!txt) return lang==='ar'
        ? "ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø³Ø¤Ø§Ù„Ùƒ Ø£ÙˆÙ„Ø§Ù‹."
        : "Please type your question first.";
      const lower = txt.toLowerCase();

      if(lang==='ar'){
        if(txt.includes("Ù…Ø±Ø­Ø¨Ø§") || txt.includes("Ø§Ù„Ø³Ù„Ø§Ù…") || txt.includes("Ø§Ù‡Ù„Ø§") || txt.includes("Ù‡Ù„Ø§"))
          return "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ";

        if(txt.includes("Ø­Ø¬Ø²") || txt.includes("Ù…ÙˆØ¹Ø¯") || txt.includes("Ø§Ø­Ø¬Ø²"))
          return "ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ Ø¨Ø³Ù‡ÙˆÙ„Ø© Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø­Ø¬Ø² Ø£Ø¹Ù„Ø§Ù‡. Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ.";

        if(txt.includes("Ø§Ù„Ø®Ø¯Ù…Ø§Øª") || txt.includes("Ø´Ùˆ Ø¨ØªÙ‚Ø¯Ù…Ùˆ") || txt.includes("Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª") || txt.includes("Ø§Ù„Ø®Ø¯Ù…Ø©"))
          return "Ù†Ù‚Ø¯Ù… Ø®Ø¯Ù…Ø§Øª Ø¹Ø§Ù…Ø© Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù„Ø£ÙŠ Ù…Ø¤Ø³Ø³Ø© Ø£Ùˆ Ø¬Ù‡Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù‡Ø© ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ùƒ.";

        if(txt.includes("ØªØ¹Ø¯ÙŠÙ„") || txt.includes("Ø§Ø­Ø°Ù") || txt.includes("Ø§Ù„ØºØ§Ø¡") || txt.includes("Ø¥Ù„ØºØ§Ø¡"))
          return "ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø­Ø°Ù Ù…ÙˆØ§Ø¹ÙŠØ¯Ùƒ Ù…Ù† ØµÙØ­Ø© (Ø­Ø¬ÙˆØ²Ø§ØªÙŠ) Ø¨Ø³Ù‡ÙˆÙ„Ø©.";

        if(txt.includes("Ù…Ø´ÙƒÙ„Ø©") || txt.includes("Ù…Ø§ Ø¨ÙŠÙØªØ­") || txt.includes("Ø¹Ø·Ù„") || txt.includes("Ø®Ø·Ø£"))
          return "ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø±Øª Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŒ Ø±Ø§Ø³Ù„Ù†Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ support@monasatak.example.";

        if(txt.includes("Ø§Ù„ÙØ±Ø¹") || txt.includes("Ø§Ù„Ù…ÙƒØ§Ù†") || txt.includes("ÙˆÙŠÙ†") || txt.includes("Ø§ÙŠÙ†"))
          return "ÙŠÙ…ÙƒÙ†Ùƒ Ø¹Ø±Ø¶ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ÙØ±ÙˆØ¹ Ø£Ùˆ Ø§Ù„Ø¬Ù‡Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù…Ù† ØµÙØ­Ø© (Ø§Ù„Ø®Ø±ÙŠØ·Ø©).";

        if(txt.includes("Ù…Ù† Ø§Ù†ØªÙ…") || txt.includes("Ø´Ùˆ Ù‡Ø§ÙŠ") || txt.includes("Ù…Ø§ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†ØµØ©") || txt.includes("Ù…ÙŠÙ†"))
          return "Ù†Ø­Ù† Ù…Ù†ØµØ© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¹Ø§Ù…Ø© Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù„Ø£ÙŠ Ø¬Ù‡Ø© Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ³Ø±Ø¹Ø© â€” Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø± Ø£Ùˆ Ø·ÙˆØ§Ø¨ÙŠØ±.";

        if(txt.includes("Ø§Ù„Ø¯ÙˆØ§Ù…") || txt.includes("Ø§ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„") || txt.includes("Ù…ØªÙ‰"))
          return "Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„ ØªØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„ØªÙŠ ØªØ®ØªØ§Ø±Ù‡Ø§. Ø¹Ø§Ø¯Ø©Ù‹ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù…ÙŠØ³ØŒ 9 ØµØ¨Ø§Ø­Ù‹Ø§ Ø¥Ù„Ù‰ 5 Ù…Ø³Ø§Ø¡Ù‹.";

        if(txt.includes("ØªÙˆØ§ØµÙ„") || txt.includes("Ø¯Ø¹Ù…") || txt.includes("Ù…Ø³Ø§Ø¹Ø¯Ø©"))
          return "ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ support@monasatak.example Ø£Ùˆ Ù…Ù† Ù‡Ù†Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø±Ø¯ Ø§Ù„Ø¢Ù„ÙŠ.";

        return "Ø´ÙƒØ±Ù‹Ø§ Ù„Ø³Ø¤Ø§Ù„Ùƒ! Ø­Ø§Ù„ÙŠÙ‹Ø§ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù…Ø«Ù„ (Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ØŒ Ø§Ù„Ø®Ø¯Ù…Ø§ØªØŒ Ø§Ù„Ø¯Ø¹Ù…ØŒ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„).";
      } else {
        if(lower.includes("hello") || lower.includes("hi") || lower.includes("good morning") || lower.includes("good evening"))
          return "Hello ğŸ‘‹! How can I help you today?";

        if(lower.includes("book") || lower.includes("appointment") || lower.includes("reserve"))
          return "You can book your appointment from the Booking page. Choose the service, date and time and confirm.";

        if(lower.includes("service") || lower.includes("services") || lower.includes("what do you offer"))
          return "We provide a general platform to book appointments for different institutions. Choose the provider and service you need.";

        if(lower.includes("edit") || lower.includes("change") || lower.includes("cancel") || lower.includes("delete"))
          return "You can edit or delete your bookings from the (My Appointments) page.";

        if(lower.includes("problem") || lower.includes("error") || lower.includes("bug") || lower.includes("not working"))
          return "Please refresh the page or check your internet connection. If the issue continues, contact us at support@monasatak.example.";

        if(lower.includes("branch") || lower.includes("location") || lower.includes("where") )
          return "You can see all branches and locations from the (Map) page.";

        if(lower.includes("who are you") || lower.includes("what is this") || lower.includes("platform"))
          return "We are an online platform for booking appointments for different providers quickly and easily.";

        if(lower.includes("working hours") || lower.includes("open") || lower.includes("close"))
          return "Working hours depend on the selected provider, but typically Sundayâ€“Thursday, 9:00 AM to 5:00 PM.";

        if(lower.includes("contact") || lower.includes("support") || lower.includes("help"))
          return "You can contact us by email at support@monasatak.example or chat here via this assistant.";

        return "Thank you for your question! For now I can answer general questions about appointments, services and support.";
      }
    }

    function attachQuickQuestionHandlers(){
      const quickButtons = document.querySelectorAll('#quickQuestions .chip');
      if(!quickButtons.length || !chatBox || !chatInput || !sendChat) return;
      quickButtons.forEach(btn=>{
        btn.onclick = () => {
          const question = btn.textContent.trim();
          appendMsg(question,'user');
          setTimeout(()=>{
            appendMsg(lang==='ar'?"Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ... â³":"Processing ... â³",'bot');
            setTimeout(()=>{
              // remove last "processing" bubble
              const msgs = chatBox.querySelectorAll('div');
              if(msgs.length) msgs[msgs.length-1].remove();
              appendMsg(aiReply(question),'bot');
            },800);
          },300);
        };
      });
    }

    if(sendChat && chatInput && chatBox){
      sendChat.addEventListener('click',()=>{
        const text=chatInput.value.trim();
        if(!text) return;
        appendMsg(text,'user');
        chatInput.value='';
        setTimeout(()=>{
          appendMsg(lang==='ar'?"Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ... â³":"Processing ... â³",'bot');
          setTimeout(()=>{
            const msgs = chatBox.querySelectorAll('div');
            if(msgs.length) msgs[msgs.length-1].remove();
            appendMsg(aiReply(text),'bot');
          },800);
        },300);
      });
      chatInput.addEventListener('keypress',e=>{
        if(e.key==='Enter') sendChat.click();
      });
    }

    function init(){
      setTimeout(()=>$('#splash').classList.add('hide'),1500);
      fillBranches('#branchSelect');
      fillBranches('#branchSelect2');
      fillCities();
      setDefaults();
      // initial services lists
      updateServices('providerSelect','serviceSelect');
      updateServices('providerSelect2','serviceSelect2');

      $('#langBtn').addEventListener('click',()=>{
        lang = (lang==='ar' ? 'en' : 'ar');
        applyLang();
        // update services text when language changes
        updateServices('providerSelect','serviceSelect');
        updateServices('providerSelect2','serviceSelect2');
        refreshMap();
      });
      $('#modeBtn').addEventListener('click',()=>{
        const r=document.documentElement;
        r.classList.toggle('dark');
        $('#modeBtn').textContent = r.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™';
      });

      applyLang();
      const hash = location.hash.replace('#','');
      show(hash||'home');
      scheduleReminders();
    }

    window.addEventListener('load', init);
  </script>
</body>
</html>
